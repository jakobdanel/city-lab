<!DOCTYPE html>
<html>

<head>
    <title> Urban Gardening </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--_____LEAFLET CSS_____-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <!--_____LEAFLET DRAW CSS_____-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.css" />
    <!--_____OWN CSS_____-->
    <link rel="stylesheet" href="stylesheets/headerFooterCustom.css" />
    <link rel="stylesheet" href="stylesheets/leaflet_style.css">
    <link rel="stylesheet" href="stylesheets/style.css">
    <!--_____LEAFLET JAVASCRIPT_____-->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
    <!--_____LEAFLET DRAW JAVASCRIPT_____-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.js"></script>
    <!--_____JQUERY AJAX JAVASCRIPT_____-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <div id="main" class="container-fluid no-gutters">
        <!--Navbar-->
        <nav class="navbar navbar-expand-lg navbar-dark  fixed-top p-1">
            <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="nav navbar-nav mr-auto mt-2 mt-lg-0">

                    <li class="nav-item">
                        <a class="nav-link active rounded" href="signin">Start</a>
                    </li>

                </ul>
            </div>
        </nav>
        <!--Main Content-->
        <div id="contentFrame" class="d-flex justify-content-center flex-wrap p-5 ">
            <div id="textContent" class=" col col-lg-4 col-12 rounded text-center mb-lg-5  row align-items-center">
                <div class="loginbox p-1 rounded  col col-12 mb-2 mr-2 p-2" style="width:fit-content;">
                    <h2>Login</h2>
                    <form class="col col-12">
                        <div class="form-group">
                            <label for="input-username" class="form-label">Username</label>
                            <input id="input-username" type="text" class="form-control" name="" placeholder="Enter Username">
                        </div>
                        <div class="form-group">
                            <label for="input-password" class="form-label">Password</label>
                            <input id="input-password" class ="form-control" type="password" name="" placeholder="Enter Password">
                        </div>
                        <input id="input-submit" type="submit" name="" value="Login" class="btn">
                        <p id="input-error" style="color: red;margin-right: 150px;"></p>
                        <!--popup for lost your password-->

                        <a href="email_popup" target="popup"
                            onclick="window.open('email_popup','popup','width=600,height=600,scrollbars=no,resizable=no'); return false;">
                            Lost your password?
                        </a>
                        <br>
                        <!--popup for join a community-->
                        <a href="email_popup" target="popup"
                            onclick="window.open('email_popup','popup','width=600,height=600,scrollbars=no,resizable=no'); return false;">
                            Join a Community?
                        </a>
                    </form>
                </div>
            </div>
            <div id="mapdiv" class="col col-lg-5 col-12 border border-dark rounded align-self-lg-end"></div>

            <!--Static Text-->
            <field type="staticText" style="text-align:left;"
                txt="This is just some simple static text with variable substitution in here: $myvariable."
                id="staticText.text" />
        </div>

    </div>
    </div>
    <!-- FOOTER-->
    <footer id="myFooter" class="row col col-12 d-flex flex-column align-items-left">
        <div class="row col col-12 d-flex flex-column ">
            <p><b>Links</b><br>
                <a href="https://www.uni-muenster.de/de/">University</a><br>
                <a href="https://github.com/jakobdanel/city-lab">GitHub Repository</a></br>
                <a href="impressum">Contact</a>
            </p>
        </div>
        <div id="copyrightText" class="footer-copyright">
            <p>Â© 2022 Urban Gardening Project </p>
        </div>
    </footer>

    <!-- JQUERY AND BOOTSTRAP JAVASCRIPT-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
        integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous">
    </script>
    <!-- local script Ressources-->
    <!--<script src="javascript/plantcaretable.js"></script>-->
    <script src="javascript/map.js"></script>
    <script>
        // Select input-username, input-password, and input-submit by id
        const inputUsername = document.getElementById("input-username");
        const inputPassword = document.getElementById("input-password");
        const inputSubmit = document.getElementById("input-submit");

        const inputError = document.getElementById("input-error");
        async function login()  {
            // Get the value of the input-username and input-password
            const username = inputUsername.value;
            const password = inputPassword.value;

         
            // Create a new fetch request
            const response = await fetch("/api/login", {
                method: "POST",
                body: JSON.stringify( {
                    username: username,
                    password: password
                }),
                headers: {
                    "Content-Type": "application/json"
                }
                
            });
            // if status is 200, then login was successful
            if (response.status === 200) {
                // Get the response body
                const body = await response.json();
                // Set the cookie
                document.cookie = `token=${body.data.token}; path=/`;
                // Redirect to the home page
                window.location.href = "/";
            } else {
                // Get the response body
                const body = await response.json();
                // Display an error message
                inputError.innerHTML = body.message;
            }
        }

        // Add an event listener to the input-submit
        inputSubmit.addEventListener("click", ()=>{
            // Check that the submit form not redirect to another page
            event.preventDefault();
            // Call the login function
            login();
        });
    </script>
</body>

</html>